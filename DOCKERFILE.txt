# üèóÔ∏è –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.11-slim

# üì¶ –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è GUI
RUN apt-get update && apt-get upgrade -y && \
    apt-get install -y --no-install-recommends \
    # Tkinter dependencies
    tk \
    tcl \
    # X11 –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    x11-apps \
    # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    procps \
    nano \
    # –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ apt
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# üåê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è GUI
# –î–ª—è Linux —Å X11 forwarding
ENV DISPLAY=:0
ENV QT_X11_NO_MITSHM=1
ENV XAUTHORITY=/tmp/.docker.xauth

# üìÇ –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# üìÑ –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
# –ó–∞–º–µ–Ω–∏—Ç–µ chess.txt –Ω–∞ chess.py –µ—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ —Ñ–∞–π–ª
COPY chess.txt chess.py

# üë®‚Äçüíª –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å requirements.txt:
# COPY requirements.txt .
# RUN pip install --no-cache-dir -r requirements.txt

# üöÄ –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["python", "chess.py"] 

# –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å Dockerfile
docker build -t chess-game:latest . 

export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0
docker run -it --rm \
  -e DISPLAY=$DISPLAY \
  -v /tmp/.X11-unix:/tmp/.X11-unix \
  chess-game:latest